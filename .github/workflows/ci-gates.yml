name: HPL CI Gates

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  ci-gates:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Gate A - Spec Integrity
        env:
          BASE_SHA: ${{ github.event.pull_request.base.sha }}
          HEAD_SHA: ${{ github.sha }}
        run: python tools/ci_gate_spec_integrity.py
      - name: Gate C - Prohibited Behavior
        run: python tools/ci_gate_prohibited_behavior.py
      - name: Gate L2-A - Registry Validation
        run: python tools/validate_operator_registries.py
      - name: Gate L2-D - Coupling Topology
        run: python tools/validate_coupling_topology.py tests/fixtures/coupling_registry_valid.json
      - name: Gate L2-D Tests - Coupling Topology
        run: python -m unittest tests/test_coupling_topology_validator.py
      - name: Gate L2-B - Traceability
        run: python -m unittest tests/test_traceability.py
      - name: Gate L2-C - Diagnostics
        run: python -m unittest tests/test_diagnostics.py
      - name: Schema Check - ProgramIR
        run: python tools/validate_ir_schema.py

